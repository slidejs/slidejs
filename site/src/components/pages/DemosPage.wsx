/** @jsxImportSource @wsxjs/wsx-core */

import { LightComponent, autoRegister } from '@wsxjs/wsx-core';
import { i18n } from '@wsxjs/wsx-i18next';
import '@wsxjs/wsx-base-components';
import styles from './DemosPage.css?inline';

@autoRegister({ tagName: 'demos-page' })
@i18n('demos')
export class DemosPage extends LightComponent {
  protected onConnected(): void {
    super.onConnected?.();
    // ç¡®ä¿ i18n å·²åŠ è½½
    if (!this.t) {
      console.warn('DemosPage: i18n not initialized, t function not available');
    }
  }
  constructor() {
    super({
      styles,
      styleName: 'demos-page',
    });
  }

  // å¤„ç† demo é“¾æ¥ç‚¹å‡»ï¼Œåœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€
  private handleDemoClick = (e: Event, link: string) => {
    e.preventDefault();
    e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡åˆ°è·¯ç”±ç³»ç»Ÿ
    window.open(link, '_blank', 'noopener,noreferrer');
  };

  render() {
    // è·å–å½“å‰ base pathï¼ˆç”¨äº GitHub Pages éƒ¨ç½²ï¼‰
    const basePath = import.meta.env.BASE_URL || '/';
    const getDemoLink = (demoId: string) => {
      // å¦‚æœ basePath æ˜¯ '/'ï¼Œç›´æ¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„
      // å¦åˆ™éœ€è¦åŒ…å« basePath
      return basePath === '/' ? `/demos/${demoId}/` : `${basePath}demos/${demoId}/`;
    };

    const demos = [
      {
        id: 'swiper',
        name: this.t('swiper.title'),
        icon: 'ğŸ¢',
        framework: this.t('swiper.framework'),
        package: this.t('swiper.package'),
        description: this.t('swiper.description'),
        link: getDemoLink('swiper'),
      },
      {
        id: 'splide',
        name: this.t('splide.title'),
        icon: 'ğŸ ',
        framework: this.t('splide.framework'),
        package: this.t('splide.package'),
        description: this.t('splide.description'),
        link: getDemoLink('splide'),
      },
      {
        id: 'revealjs',
        name: this.t('revealjs.title'),
        icon: 'ğŸ“Š',
        framework: this.t('revealjs.framework'),
        package: this.t('revealjs.package'),
        description: this.t('revealjs.description'),
        link: getDemoLink('revealjs'),
      },
    ];

    return (
      <div class="demos-page">
        <section class="demos-hero">
          <div class="demos-hero-container">
            <h1 class="demos-title">{this.t('title')}</h1>
            <p class="demos-subtitle">{this.t('subtitle')}</p>
          </div>
        </section>

        <section class="demos-grid-section">
          <div class="demos-grid-container">
            <div class="demos-grid">
              {demos.map(demo => (
                <a
                  href={demo.link}
                  onClick={(e: Event) => this.handleDemoClick(e, demo.link)}
                  class="demo-card"
                  aria-label={`${this.t('viewDemo')}: ${demo.name}`}
                >
                  <div class="demo-icon">{demo.icon}</div>
                  <h3 class="demo-name">{demo.name}</h3>
                  <div class="demo-meta">
                    <span class="demo-framework">{demo.framework}</span>
                    <span class="demo-package">{demo.package}</span>
                  </div>
                  <p class="demo-description">{demo.description}</p>
                  <div class="demo-link">{this.t('viewDemo')} â†’</div>
                </a>
              ))}
            </div>
          </div>
        </section>
      </div>
    );
  }
}
